<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DressFy - Upload de Imagens</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 20px 0; }
        .image-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .image-item { border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
        .image-item img { width: 100%; height: 200px; object-fit: cover; }
        .api-info { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .success { color: green; } .error { color: red; }
    </style>
</head>
<body>
    <h1>üõçÔ∏è DressFy - Sistema de Upload de Imagens</h1>
    
    <div class="api-info">
        <h3>üì∏ Funcionalidades Testadas com Imagens Reais:</h3>
        <ul>
            <li>‚úÖ Upload de fotos de c√¢mera (JPG, PNG)</li>
            <li>‚úÖ M√∫ltiplas imagens por produto</li>
            <li>‚úÖ Imagens HD (at√© 10MB)</li>
            <li>‚úÖ Organiza√ß√£o por item/produto</li>
            <li>‚úÖ URLs de acesso direto</li>
            <li>‚úÖ Valida√ß√£o de formatos</li>
        </ul>
    </div>

    <h2>üì§ Upload de Imagens</h2>
    <form id="uploadForm" enctype="multipart/form-data">
        <div>
            <label>Item ID:</label>
            <select id="itemId" required>
                <option value="1">Item 1 - Vestido Rosa</option>
                <option value="2">Item 2 - Vestido Branco</option>
                <option value="5">Item 5 - Cal√ßa Jeans Masculina</option>
            </select>
        </div><br>
        
        <div>
            <label>Descri√ß√£o:</label>
            <input type="text" id="descricao" placeholder="Ex: Foto principal, detalhes, vista lateral..." />
        </div><br>
        
        <div class="upload-area">
            <input type="file" id="imagens" multiple accept="image/*" required />
            <p>Clique para selecionar ou arraste imagens aqui</p>
            <small>Formatos: JPG, PNG, GIF, WEBP (m√°x. 10MB cada, at√© 5 arquivos)</small>
        </div>
        
        <button type="submit">üì§ Fazer Upload</button>
    </form>

    <div id="result"></div>

    <h2>üñºÔ∏è Galeria de Imagens</h2>
    <div>
        <button onclick="loadImages(1)">Ver Item 1</button>
        <button onclick="loadImages(2)">Ver Item 2</button>
        <button onclick="loadImages(5)">Ver Item 5 (Cal√ßa Jeans)</button>
    </div>
    
    <div id="gallery" class="image-gallery"></div>

    <div class="api-info">
        <h3>üîó Endpoints da API:</h3>
        <ul>
            <li><strong>POST</strong> /api/imagens - Upload de imagens</li>
            <li><strong>GET</strong> /api/imagens?item_id=X - Listar imagens</li>
            <li><strong>GET</strong> /api/imagens/{itemId}/{filename} - Acessar imagem</li>
            <li><strong>DELETE</strong> /api/imagens/{id} - Deletar imagem</li>
        </ul>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const files = document.getElementById('imagens').files;
            const itemId = document.getElementById('itemId').value;
            const descricao = document.getElementById('descricao').value;
            
            if (files.length === 0) {
                alert('Selecione pelo menos uma imagem');
                return;
            }
            
            // Adicionar arquivos
            for (let file of files) {
                formData.append('imagens', file);
            }
            formData.append('item_id', itemId);
            formData.append('descricao', descricao);
            
            try {
                const response = await fetch(`${API_BASE}/imagens`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.error) {
                    document.getElementById('result').innerHTML = 
                        `<div class="error">‚ùå Erro: ${result.message || 'Erro desconhecido'}</div>`;
                } else {
                    document.getElementById('result').innerHTML = 
                        `<div class="success">‚úÖ ${result.data.message}</div>`;
                    loadImages(itemId); // Recarregar galeria
                }
            } catch (error) {
                document.getElementById('result').innerHTML = 
                    `<div class="error">‚ùå Erro de conex√£o: ${error.message}</div>`;
            }
        });
        
        async function loadImages(itemId) {
            try {
                const response = await fetch(`${API_BASE}/imagens?item_id=${itemId}`);
                const result = await response.json();
                
                const gallery = document.getElementById('gallery');
                
                if (result.data.length === 0) {
                    gallery.innerHTML = '<p>Nenhuma imagem encontrada para este item.</p>';
                    return;
                }
                
                gallery.innerHTML = result.data.map(img => `
                    <div class="image-item">
                        <img src="${API_BASE}/imagens/${img.item_id}/${img.url.split('/').pop()}" 
                             alt="${img.descricao}" />
                        <p><strong>ID:</strong> ${img.id}</p>
                        <p><strong>Descri√ß√£o:</strong> ${img.descricao || 'Sem descri√ß√£o'}</p>
                        <p><strong>Upload:</strong> ${new Date(img.criado_em).toLocaleString()}</p>
                        <button onclick="deleteImage(${img.id})" style="background: red; color: white;">
                            üóëÔ∏è Deletar
                        </button>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('gallery').innerHTML = 
                    `<div class="error">‚ùå Erro ao carregar imagens: ${error.message}</div>`;
            }
        }
        
        async function deleteImage(id) {
            if (!confirm('Tem certeza que deseja deletar esta imagem?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/imagens/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.error) {
                    alert(`Erro: ${result.message}`);
                } else {
                    alert('‚úÖ Imagem deletada com sucesso!');
                    // Recarregar a galeria atual
                    const itemId = document.getElementById('itemId').value;
                    loadImages(itemId);
                }
            } catch (error) {
                alert(`Erro de conex√£o: ${error.message}`);
            }
        }
        
        // Carregar imagens do item 5 ao iniciar
        loadImages(5);
    </script>
</body>
</html>